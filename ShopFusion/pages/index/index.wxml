<!-- index.wxml -->
<view class="page-container">
  <!-- 搜索栏 -->
  <van-search
    placeholder="搜索商品"
    bind:search="onSearch"
    show-action
    bind:cancel="onCancel"
  />

  <!-- 筛选栏 -->
  <view class="filter-bar">
    <van-tag
      color="{{filterSelected.onePerson ? '#ff3c3c' : '#f5f5f5'}}"
      text-color="{{filterSelected.onePerson ? 'white' : 'black'}}"
      bindtap="onFilterClick"
      data-type="onePerson"
    >
      只差一人
    </van-tag>
    <van-tag
      color="{{filterSelected.mySubscription ? '#ff3c3c' : '#f5f5f5'}}"
      text-color="{{filterSelected.mySubscription ? 'white' : 'black'}}"
      bindtap="onFilterClick"
      data-type="mySubscription"
    >
      我的订阅
    </van-tag>
  </view>

  <!-- 商品列表 -->
  <scroll-view
    class="scroll-view"
    scroll-y
    style="height: calc(100vh - 140rpx);"
    bindscrolltolower="onScrollToLower"
    bindrefresherrefresh="onPullDownRefresh"
    refresher-enabled="true"
    refresher-triggered="{{isRefreshing}}"
  >
    <view class="product-list">
      <block wx:for="{{filteredProductList}}" wx:key="id">
        <van-card
          thumb="{{item.imageUrl}}"
          title="{{item.title}}"
          price="¥{{item.price}}"
          desc="优惠：¥{{item.discountPrice}}"
          tag="{{item.countdown}}"
          bind:click="onProductClick"
          data-item="{{item}}"
        >
          <view slot="num">
            还差{{item.groupRemainCount}}人拼团成功
          </view>
          <view slot="footer">
            <van-button type="info" size="mini" bind:tap="onJoinGroup" data-keycode="{{item.keyCode}}">参与拼团</van-button>
          </view>
        </van-card>
      </block>

      <!-- 加载更多 -->
      <view class="loading-area" wx:if="{{loadingMore}}">
        <van-loading size="24px" type="spinner" />
        <text>正在加载...</text>
      </view>

      <!-- 没有更多商品了 -->
      <view class="no-more" wx:if="{{!hasMore && !loadingMore && filteredProductList.length > 0}}">
        <text>没有更多商品了</text>
      </view>

      <!-- 没有数据 -->
      <view class="no-data" wx:if="{{filteredProductList.length === 0 && !loadingMore}}">
        <text>没有符合条件的商品</text>
      </view>

    </view>
  </scroll-view>
</view>
